class "Бланк Временных Данных";  --Предназначен для решения временных и частных задачь.

Import   ТаблДокумент  Classes Функции;

inclass Public

--{ inClass
  func Новый  синоним On ( t: Вариант = Nil ) : ТаблДокумент.ВременныйБланк ;
     Result = inherited Create;
--     ВставитьВМассив(МоиОбъекты, ДлинаМассива(МоиОбъекты)+1, Result);
     Result.Own = t;
     Result.Init(Result);
  end ;
--} inClass

inobject Public

--{ inObject Перем

 Current           :2 0ТаблДокумент.ВременныйБланк ;
 ПутьКДопШабл      : Строка;                   --Перем
 SecTemp           : TemplateSection;          --Перем
 SectionsCount     : Целое ;                   --Перем
 КоличествоФреймов : Целое ;                   --Перем
 КоличествоСтрок   : Целое ;                   --Перем
 КоличествоКолонок : Целое ;                   --Перем
 ВысотаШаблона     : Целое ;                   --Перем
 ШиринаШаблона     : Целое ;                   --Перем
 Хозяин  Synonym   Own : Вариант;              --Перем
 НомерОбъекта      : Целое;                    --Перем
 ИмяОбъекта        : Строка;                   --Перем

--} inObject Перем

--{ inObject proc
--------------------------------------------------------------------------------
  proc Init 2(0CurAr2a : 0ТаблДокумент.ВременныйБланк2)0;

     ПутьКДопШабл      = "";
     SecTemp           = Nil;
     SectionsCount     = 0 ;
     КоличествоФреймов = 0 ;
     КоличествоСтрок   = 0 ;
     КоличествоКолонок = 0 ;

     Если CurAr2a0.Template.RootFrame.SectionsCount=0 Тогда
       SecTemp = CurAr2a0.Template.RootFrame.InsertSection(1);   -- БланкМакета.Шаблон.ТекущийФрейм.Имя = "RootFrame"
     иначе
       SectionsCount = CurAr2a0.Template.RootFrame.SectionsCount;
       Пока SectionsCount>0 ЦИКЛ
         CurAr2a0.Template.RootFrame.DeleteSection(SectionsCount) ;
         SectionsCount = CurAr2a0.Template.RootFrame.SectionsCount;
       Лкиц;
       SecTemp = CurAr2a0.Template.RootFrame.InsertSection(1);   -- БланкМакета.Шаблон.ТекущийФрейм.Имя = "RootFrame"
       CurAr2a0.Template.CurrentSection = SecTemp;
     Илсе;

     Обновить;

    НомерОбъекта = CurAr2a0.ЧислоОбъектов;
    ИмяОбъекта   = "ВременныйБланК_" + Стр(НомерОбъекта);
    Current = CurAr2a0;


  end;
--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
  proc Загрузить (Context :Строка);
    Если Context="" Тогда
    Иначе
       Self.LoadTemplate (Context, -1);
       ПутьКДопШабл  = Context;
       Обновить;
    Илсе;
  end;
--------------------------------------------------------------------------------
  Проц Обновить;
       SectionsCount     = Self.Template.CurrentFrame.SectionsCount;
       КоличествоФреймов = ВзятьВсеФреймы2Бланка0(Self.Template2.0RootFrame);
       КоличествоСтрок   = SecTemp.КоличествоСтрок;
       КоличествоКолонок = SecTemp.ColumnsCount;
  Цорп;
--------------------------------------------------------------------------------
  proc ПриУничтожении ;
    унаследованный ПриУничтожении ;    --Синоним OnDestroy

--   Хозяин = Nil;
--
--   Если Current = nil Тогда
----      Трассировка("При выполнении - 'OnDestroy' для 'Current', пустой Объект 'Временный Бланк'!");
--   Иначе
--
----      НомерОбъекта = Current.ЧислоОбъектов;
----      ИмяОбъекта   = "Временный Бланк - " + Стр(НомерОбъекта);
----      Трассировка("Уничтожение объекта для 'Current' - "+ИмяОбъекта);
--
--     Current = nil;        -- Self
--   Илсе;
--   Если Self = nil Тогда
----      Трассировка("При выполнении - 'OnDestroy' для 'Self', пустой Объект 'Временный Бланк'!");
--   Иначе
--
----      НомерОбъекта = Self.ЧислоОбъектов;
----      ИмяОбъекта   = "Временный Бланк - " + Стр(НомерОбъекта);
----      Трассировка("Уничтожение объекта для 'Self' - "+ИмяОбъекта);
--
--     Self = nil;        -- Self
--   Илсе;

  end;
-----------------------
  proc Уничтожение Синоним Destroy;

    var p, p1: Вариант ;

    p = Current;
    p1 = p.Хозяин;
    while p1 <> nil do
      p = p1;
      p1 = p1.Хозяин;
      p.Хозяин = nil;
    od;
    Current.Хозяин = nil;

    p = Self;
    p1 = p.Хозяин;
    while p1 <> nil do
      p = p1;
      p1 = p1.Хозяин;
      p.Хозяин = nil;
    od;
    Self.Хозяин = nil;

  end;
  -------------------------------------------------
--} inObject

end